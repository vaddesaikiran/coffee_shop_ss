<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Coffee</title>
    <script>
        // Function to get CSRF token from meta tag
        function getCsrfToken() {
            const token = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            return token;
        }

        function showAlert(message) {
            alert(message);
        }

        function handleSubmit(event) {
            event.preventDefault(); // Prevent the form from submitting the default way

            const coffeeId = document.getElementById('coffeeId').value;

            // Fetch CSRF token
            const csrfToken = getCsrfToken();

            // Add CSRF token to request header
            fetch(`/buycoffee/${coffeeId}`, {
                method: 'POST',
                headers: {
                    'X-CSRF-TOKEN': csrfToken
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text(); // Parse response as text
                }
                throw new Error('Coffee not found');
            })
            .then(data => {
                showAlert(data); // Display success message with coffee name
                document.getElementById('buyCoffeeForm').reset(); // Reset form after submission
            })
            .catch(error => {
                showAlert(error.message); // Display error message
            });
        }
    </script>
</head>
<body>
    <meta name="_csrf" th:content="${_csrf.token}"/> <!-- Inject CSRF token into the meta tag -->
    
	<nav>
        <a href="/orders">Orders</a>
        <a href="/home">Home</a>
        <a href="/contact-us">Contact Us</a>
    </nav>
    <h1>Buy Coffee</h1>

    <form id="buyCoffeeForm" th:action="@{/buycoffee}" method="post" onsubmit="return handleSubmit(event)">
        <label for="coffeeId">Enter Coffee ID: </label>
        <input type="number" id="coffeeId" name="coffeeId" required>
        <button type="submit">Buy Coffee</button>
    </form>

    <h2>Available Coffee Options</h2>
    <div id="coffeeList">
        <ul>
            <th:block th:each="coffee : ${coffees}">
                <li th:text="${coffee.name} + ' - ID: ' + ${coffee.id}"></li>
            </th:block>
        </ul>
    </div>
</body>
</html>
